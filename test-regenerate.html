<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Rigenera</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .test { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
        button { padding: 10px 20px; margin: 10px 0; }
        .team { display: inline-block; width: 45%; vertical-align: top; margin: 10px; }
    </style>
</head>
<body>
    <h1>Test Funzione Rigenera</h1>
    
    <button onclick="runTest()">Esegui Test</button>
    <button onclick="testMultipleGenerations()">Test Multiple Generazioni</button>
    
    <div id="results"></div>

    <script src="js/generator.js"></script>
    <script>
        // Dati di test
        const testPlayers = [
            { id: 1, nome: 'Mario Rossi', ruolo: 'ATT', forma: 8, difesa: 5, passaggi: 7, attacco: 9, dribbling: 8 },
            { id: 2, nome: 'Luigi Bianchi', ruolo: 'DIF', forma: 7, difesa: 9, passaggi: 6, attacco: 4, dribbling: 5 },
            { id: 3, nome: 'Paolo Verdi', ruolo: 'CEN', forma: 8, difesa: 6, passaggi: 8, attacco: 7, dribbling: 7 },
            { id: 4, nome: 'Marco Neri', ruolo: 'ATT', forma: 9, difesa: 4, passaggi: 6, attacco: 9, dribbling: 9 },
            { id: 5, nome: 'Andrea Gialli', ruolo: 'DIF', forma: 7, difesa: 8, passaggi: 7, attacco: 5, dribbling: 6 },
            { id: 6, nome: 'Luca Blu', ruolo: 'CEN', forma: 8, difesa: 7, passaggi: 9, attacco: 6, dribbling: 7 },
            { id: 7, nome: 'Stefano Rosa', ruolo: 'JOLLY', forma: 8, difesa: 7, passaggi: 7, attacco: 7, dribbling: 8 },
            { id: 8, nome: 'Giovanni Viola', ruolo: 'ATT', forma: 7, difesa: 5, passaggi: 6, attacco: 8, dribbling: 7 },
            { id: 9, nome: 'Francesco Arancio', ruolo: 'DIF', forma: 6, difesa: 8, passaggi: 6, attacco: 4, dribbling: 5 },
            { id: 10, nome: 'Antonio Marrone', ruolo: 'CEN', forma: 7, difesa: 6, passaggi: 8, attacco: 6, dribbling: 6 }
        ];

        function runTest() {
            const results = document.getElementById('results');
            results.innerHTML = '<h2>Test in corso...</h2>';

            try {
                // Test 1: generateTeams (migliore)
                console.log('Test 1: generateTeams');
                const result1 = generator.generateTeams(testPlayers);
                console.log('Result 1:', result1);

                // Test 2: generateRandomTeams
                console.log('Test 2: generateRandomTeams');
                const result2 = generator.generateRandomTeams(testPlayers);
                console.log('Result 2:', result2);

                // Test 3: altra generazione random
                console.log('Test 3: generateRandomTeams (2)');
                const result3 = generator.generateRandomTeams(testPlayers);
                console.log('Result 3:', result3);

                // Verifica che siano diverse
                const team1Ids = result1.teamA.map(p => p.id).sort().join(',');
                const team2Ids = result2.teamA.map(p => p.id).sort().join(',');
                const team3Ids = result3.teamA.map(p => p.id).sort().join(',');

                let html = '<div class="test success">';
                html += '<h3>✓ Test Completato</h3>';
                html += '<h4>Generazione 1 (Best):</h4>';
                html += `<div class="team"><strong>Team A (${result1.balance}%):</strong><br>${result1.teamA.map(p => p.nome).join('<br>')}</div>`;
                html += `<div class="team"><strong>Team B:</strong><br>${result1.teamB.map(p => p.nome).join('<br>')}</div>`;
                
                html += '<h4>Generazione 2 (Random):</h4>';
                html += `<div class="team"><strong>Team A (${result2.balance}%):</strong><br>${result2.teamA.map(p => p.nome).join('<br>')}</div>`;
                html += `<div class="team"><strong>Team B:</strong><br>${result2.teamB.map(p => p.nome).join('<br>')}</div>`;
                
                html += '<h4>Generazione 3 (Random):</h4>';
                html += `<div class="team"><strong>Team A (${result3.balance}%):</strong><br>${result3.teamA.map(p => p.nome).join('<br>')}</div>`;
                html += `<div class="team"><strong>Team B:</strong><br>${result3.teamB.map(p => p.nome).join('<br>')}</div>`;

                html += '<h4>Verifica Diversità:</h4>';
                html += `<p>Team 1 IDs: ${team1Ids}</p>`;
                html += `<p>Team 2 IDs: ${team2Ids}</p>`;
                html += `<p>Team 3 IDs: ${team3Ids}</p>`;
                
                if (team1Ids !== team2Ids || team2Ids !== team3Ids) {
                    html += '<p style="color: green;">✓ Le squadre sono DIVERSE tra loro</p>';
                } else {
                    html += '<p style="color: red;">✗ PROBLEMA: Le squadre sono UGUALI</p>';
                }

                html += '</div>';
                results.innerHTML = html;

            } catch (error) {
                results.innerHTML = `<div class="test error"><h3>✗ Errore</h3><pre>${error.message}\n${error.stack}</pre></div>`;
            }
        }

        function testMultipleGenerations() {
            const results = document.getElementById('results');
            results.innerHTML = '<h2>Test Multiple Generazioni...</h2>';

            try {
                const generations = [];
                const uniqueTeams = new Set();

                // Genera 10 volte
                for (let i = 0; i < 10; i++) {
                    const result = generator.generateRandomTeams(testPlayers);
                    const teamIds = result.teamA.map(p => p.id).sort().join(',');
                    uniqueTeams.add(teamIds);
                    generations.push({
                        num: i + 1,
                        balance: result.balance,
                        teamIds: teamIds
                    });
                }

                let html = '<div class="test success">';
                html += '<h3>Test 10 Generazioni Random</h3>';
                html += `<p><strong>Combinazioni uniche: ${uniqueTeams.size}/10</strong></p>`;
                
                if (uniqueTeams.size >= 8) {
                    html += '<p style="color: green;">✓ OTTIMO: Alta varietà nelle generazioni</p>';
                } else if (uniqueTeams.size >= 5) {
                    html += '<p style="color: orange;">⚠ MEDIO: Discreta varietà</p>';
                } else {
                    html += '<p style="color: red;">✗ PROBLEMA: Poca varietà nelle generazioni</p>';
                }

                html += '<table border="1" cellpadding="5"><tr><th>#</th><th>Equilibrio</th><th>Team A IDs</th></tr>';
                generations.forEach(g => {
                    html += `<tr><td>${g.num}</td><td>${g.balance}%</td><td>${g.teamIds}</td></tr>`;
                });
                html += '</table>';

                html += '</div>';
                results.innerHTML = html;

            } catch (error) {
                results.innerHTML = `<div class="test error"><h3>✗ Errore</h3><pre>${error.message}\n${error.stack}</pre></div>`;
            }
        }

        // Auto-run al caricamento
        window.addEventListener('load', () => {
            console.log('Generator loaded:', generator);
            runTest();
        });
    </script>
</body>
</html>
